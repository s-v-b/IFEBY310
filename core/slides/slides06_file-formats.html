<!DOCTYPE html>
<html lang="en-US"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-9a023c9ade86a60361e96e3e3f11bc54.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.js" defer="true"></script>
<link href="../../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/grid-no-htext-1.0.0/grid_no_htext.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Équipe de Statistique">
  <meta name="dcterms.date" content="2025-01-17">
  <title>IFEBY310 - Spring 2025 – File formats</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #e1e4e8; background-color: #24292e; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #e1e4e8; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #f97583; } /* Attribute */
    code span.bn { color: #79b8ff; } /* BaseN */
    code span.bu { color: #f97583; } /* BuiltIn */
    code span.cf { color: #f97583; } /* ControlFlow */
    code span.ch { color: #9ecbff; } /* Char */
    code span.cn { color: #79b8ff; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #f97583; } /* DataType */
    code span.dv { color: #79b8ff; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #f97583; font-weight: bold; } /* Extension */
    code span.fl { color: #79b8ff; } /* Float */
    code span.fu { color: #b392f0; } /* Function */
    code span.im { color: #9ecbff; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #f97583; } /* Keyword */
    code span.op { color: #e1e4e8; } /* Operator */
    code span.ot { color: #b392f0; } /* Other */
    code span.pp { color: #f97583; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #79b8ff; } /* SpecialChar */
    code span.ss { color: #9ecbff; } /* SpecialString */
    code span.st { color: #9ecbff; } /* String */
    code span.va { color: #ffab70; } /* Variable */
    code span.vs { color: #9ecbff; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-4261b23fa083684dd74643306b934958.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script>
  MathJax = {
    loader: {
      load: ['[tex]/boldsymbol']
    },
    tex: {
      tags: "all",
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      packages: {
        '[+]': ['boldsymbol']
      }
    }
  };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
<meta property="og:title" content="File formats – IFEBY310 - Spring 2025">
<meta property="og:description" content="Technologies Big Data Master MIDS/MFA/LOGOIS">
<meta property="og:site_name" content="IFEBY310 - Spring 2025">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#1c191c" class="quarto-title-block center">
  <h1 class="title">File formats</h1>
  <p class="subtitle"><a href="https://s-v-b.github.io/IFEBY030/">Technologies Big Data Master MIDS/MFA/LOGOIS</a></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Équipe de Statistique 
</div>
        <p class="quarto-title-affiliation">
            <a href="https://u-paris.fr">LPSM Université Paris-Cité</a>
          </p>
    </div>
</div>

  <p class="date">2025-01-17</p>
</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Roadmap</h2>
<ul>
<li><a href="#/file-formats" id="/toc-file-formats">File formats</a></li>
<li><a href="#/main-file-formats-for-big-data" id="/toc-main-file-formats-for-big-data">Main file formats for big data</a></li>
<li><a href="#/avro" id="/toc-avro"><code>Avro</code></a></li>
<li><a href="#/parquet" id="/toc-parquet"><code>Parquet</code></a></li>
<li><a href="#/orc" id="/toc-orc"><code>ORC</code></a></li>
<li><a href="#/comparison-between-formats" id="/toc-comparison-between-formats">Comparison between formats</a></li>
<li><a href="#/how-to-choose-a-file-format" id="/toc-how-to-choose-a-file-format">How to choose a file format</a></li>
</ul>
</nav>
</section>
<section>
<section id="file-formats" class="title-slide slide level1 center" data-background-color="#1c191c">
<h1>File formats</h1>

</section>
<section id="file-formats-1" class="slide level2 center">
<h2>File formats</h2>
<ul>
<li><p>You will need to choose the <em>right format</em> for your data</p></li>
<li><p>The right format typically <em>depends on the use-case</em></p></li>
</ul>
</section>
<section id="why-different-file-formats" class="slide level2 center">
<h2>Why different file formats ?</h2>
<ul>
<li><p>A <strong>huge bottleneck</strong> for big data applications is <em>time spent to find data</em> in a particular location and <em>time spent to write it</em> back to another location</p></li>
<li><p>Even more complicated with <strong>large datasets</strong> with <em>evolving schemas</em>, or <em>storage constraints</em></p></li>
<li><p>Several <code>Hadoop</code> file formats <strong>evolved to ease these issues</strong> across a number of use cases</p></li>
</ul>
</section>
<section id="file-formats-trade-offs" class="slide level2 center">
<h2>File formats (trade-offs)</h2>
<p>Choosing an appropriate file format has the following potential benefits</p>
<ul>
<li><p>Faster <strong>reads</strong> or faster <strong>writes</strong></p></li>
<li><p><strong>Splittable</strong> files</p></li>
<li><p><strong>Schema evolution</strong> support (schema changes over time)</p></li>
<li><p><strong>Advanced compression</strong> support</p></li>
</ul>
<p>Some file formats are designed for <em>general use</em></p>
<p>Others for more <em>specific use cases</em></p>
<p>Some with <em>specific data characteristics</em> in mind</p>
<aside class="notes">
<p>What is the meaning of <em>Schema</em>? May depend on format.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="main-file-formats-for-big-data" class="title-slide slide level1 center" data-background-color="#1c191c">
<h1>Main file formats for big data</h1>

</section>
<section id="main-file-formats" class="slide level2 center">
<h2>Main file formats</h2>
<div class="center">
<p><img src="../../images/parquet.png" style="width: 30%;"> <img src="" style="width: 5%;"> <img src="../../images/orc.png" style="width: 23%;"> <img src="" style="width: 5%;"> <img src="../../images/avro.png" style="width: 25%;"></p>
</div>
<p>We shall talk about the <em>core concepts</em> and <em>use-cases</em> for the following popular data formats:</p>
<ul>
<li><p><code>Avro</code> : <a href="https://avro.apache.org">https://avro.apache.org</a></p></li>
<li><p><code>ORC</code> : <a href="https://parquet.apache.org">https://parquet.apache.org</a></p></li>
<li><p><code>Parquet</code> : <a href="https://orc.apache.org">https://orc.apache.org</a></p></li>
</ul>
</section></section>
<section>
<section id="avro" class="title-slide slide level1 center" data-background-color="#1c191c">
<h1><code>Avro</code></h1>

</section>
<section id="avro-principles" class="slide level2 center">
<h2>Avro: Principles</h2>
<div class="columns">
<div class="column">
<ul>
<li><p><code>Avro</code> is a <em>row-based data format and data serialization system</em> released by the <code>Hadoop</code> working group in 2009</p></li>
<li><p>Data schema is stored as <code>JSON</code> in the header. Rest of the data stored in a <strong>binary format</strong> to make it compact and efficient</p></li>
<li><p><code>Avro</code> is language-neutral and can be used by many languages (for now <code>C</code>, <code>C++</code>, <code>...</code>, <code>Python</code>, and <code>R</code>)</p></li>
<li><p>One shining point of <code>Avro</code>: <em>robust support for schema evolution</em></p></li>
</ul>
</div><div class="column">
<p><img data-src="../../images/avro.png"></p>
</div></div>
<aside class="notes">
<p>Avro is used in streaming applications</p>
<p>On Hadoop portal, Avro is described as a data serialization system</p>
<p>In the old days, Avro used to be an aircraft manufacturer</p>
<blockquote>
<p>https://en.wikipedia.org/wiki/Avro</p>
</blockquote>
<blockquote>
<p>Confluent Platform works with any data format you prefer, but we added some special facilities for Avro because of its popularity. In the rest of this document I’ll go through some of the reasons why.</p>
</blockquote>
<blockquote>
<p>Avro has a JSON like data model, but can be represented as either JSON or in a compact binary form. It comes with a very sophisticated schema description language that describes data.</p>
</blockquote>
<blockquote>
<p>We think Avro is the best choice for a number of reasons:</p>
</blockquote>
<ul>
<li>It has a direct mapping to and from JSON</li>
<li>It has a very compact format. The bulk of JSON, repeating every field name with every single record, is what makes JSON inefficient for high-volume usage.</li>
<li>It is very fast.</li>
<li>It has great bindings for a wide variety of programming languages so you can generate Java objects that make working with event data easier, but it does not require code generation so tools can be written generically for any data stream.</li>
<li>It has a rich, extensible schema language defined in pure JSON</li>
<li>It has the best notion of compatibility for evolving your data over time.</li>
<li>Though it may seem like a minor thing handling this kind of metadata turns out to be one of the most critical and least appreciated aspects in keeping data high quality and easily useable at organizational scale.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="avro-rationale" class="slide level2 center scrollable">
<h2><code>Avro</code>: rationale</h2>
<ul>
<li><code>Avro</code> provides rich data structures: can create a record that contains an array, an enumerated type and a sub-record</li>
</ul>
<p>Ideal candidate to <em>store data in a data lake</em> since:</p>
<ol type="1">
<li><p>Data is usually <strong>read as a whole</strong> in a data lake for further processing by downstream systems</p></li>
<li><p>Downstream systems can <strong>retrieve schemas easily from files</strong> (no need to store the schemas separately).</p></li>
<li><p>Any source <em>schema change is easily handled</em></p></li>
</ol>

<aside><div>
<ul>
<li>data lake</li>
<li>data warehouse</li>
<li>databse</li>
</ul>
<p>Spot the differences</p>
</div></aside></section>
<section id="avro-organization" class="slide level2 center">
<h2><code>Avro</code>: organization</h2>
<div class="center">
<p><img src="../../images/avro-file.png" style="width: 100%;"></p>
</div>
</section></section>
<section>
<section id="parquet" class="title-slide slide level1 center" data-background-color="#1c191c">
<h1><code>Parquet</code></h1>

</section>
<section id="parquet-history-and-principles" class="slide level2 center">
<h2>Parquet: History and Principles</h2>
<div class="columns">
<div class="column">
<ul>
<li><p><code>Parquet</code> is an open-source file format for <a href="https://hadoop.apache.org"><code>Hadoop</code></a> created by <a href="https://en.wikipedia.org/wiki/Cloudera"><code>Cloudera</code></a> and <a href=""><code>Twitter</code> <i class="fa-brands fa-twitter" aria-label="twitter"></i></a> in 2013</p></li>
<li><p>It stores <strong>nested data structures</strong> in a <em>flat columnar format</em>.</p></li>
<li><p>Compared to traditional <strong>row-oriented approaches</strong>, <code>Parquet</code> is <em>more efficient in terms of storage and performance</em></p></li>
<li><p>It is especially good for queries that need <em>read a small subset of columns</em> from a data file with many columns : <em>only the required columns are read</em> (optimized I/O)</p></li>
</ul>
</div><div class="column">
<p><img data-src="../../images/parquet.png"></p>
</div></div>
<!-- end columns -->
<aside class="notes">
<ul>
<li>meaning of nested data structure</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="parquet-row-wise-vs-columnar-storage-format" class="slide level2 center">
<h2>Parquet: Row-wise VS columnar storage format</h2>
<p>If you have a dataframe like this</p>
<pre><code>+----+-------+----------+
| ID | Name  | Product  | 
+----+-------+----------+
| 1  | name1 | product1 |
| 2  | name2 | product2 |
| 3  | name3 | product3 |
+----+-------+----------+</code></pre>
<p>In <strong>row-wise</strong> storage format <em>records are contiguous</em> in the file:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="dv">1</span> name1 product1 <span class="dv">2</span> name2 product2 <span class="dv">3</span> name3 product3 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While in the <strong>columnar storage</strong> format, <em>columns are stored together</em>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> name1 name2 name3 product1 product2 product3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="parquet-organization" class="slide level2 center">
<h2><code>Parquet</code>: organization</h2>
<ul>
<li><p>This makes <strong>columnar storage</strong> more efficient when <em>querying a few columns</em> from the table</p></li>
<li><p>No need to read whole records, but only the <em>required columns</em></p></li>
<li><p>A unique feature of <code>Parquet</code> is that even <em>nested fields</em> can be read individually without the need to read all the fields</p></li>
<li><p><code>Parquet</code> uses <strong>record shredding</strong> and an <strong>assembly algorithm</strong> to store nested structures in a columnar fashion</p></li>
</ul>
<aside class="notes">
<p>Examples of nested fields</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="parquet-organization-continued" class="slide level2 center">
<h2><code>Parquet</code>: organization (continued)</h2>
<div class="center">
<p><img src="../../images/parquet-format.gif" style="width: 80%;"></p>
</div>
</section>
<section id="parquet-organization-lexikon" class="slide level2 center">
<h2><code>Parquet</code>: organization (lexikon)</h2>
<p>The main entities in a <code>Parquet</code> file are the following:</p>
<dl>
<dt>Row group</dt>
<dd>
a horizontal partitioning of the data into rows. A row group consists of a column chunk for each column in the dataset
</dd>
<dt>Column chunk</dt>
<dd>
a chunk of the data for a particular column. These column chunks live in a particular row group and are guaranteed to be contiguous in the file
</dd>
<dt>Page</dt>
<dd>
column chunks are divided up into pages written back to back. The pages share a common header and readers can skip the page they are not interested in
</dd>
</dl>
</section>
<section id="about-parquet" class="slide level2 center">
<h2>About <code>Parquet</code></h2>
<div class="center">
<p><img src="../../images/parquet-dive.png" style="width: 80%;"></p>
</div>
</section>
<section id="parquet-headers-and-footers" class="slide level2 center">
<h2><code>Parquet</code>: headers and footers</h2>
<ul>
<li>The header just contains a magic number “PAR1” (4-byte) that identifies the file as <code>Parquet</code> format file</li>
</ul>
<p>The footer contains:</p>
<ul>
<li><p><strong>File metadata</strong>: all the locations of all the column metadata start locations. Readers first read the file metadata to find the column chunks they need. Column chunks are then read sequentially. It also includes the format version, the schema, and any extra key-value pairs.</p></li>
<li><p><strong>length</strong> of file metadata (4-byte)</p></li>
<li><p><strong>magic number</strong> “PAR1” (4-byte)</p></li>
</ul>
</section></section>
<section>
<section id="orc" class="title-slide slide level1 center" data-background-color="#1c191c">
<h1><code>ORC</code></h1>

</section>
<section id="orc-principles" class="slide level2 center">
<h2>ORC: principles</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><p><code>ORC</code> stands for <em>Optimized Row Columnar</em> file format. Created by Hortonworks in 2013 in order to speed up <code>Hive</code> <i class="fa-brands fa-hive" aria-label="hive"></i></p></li>
<li><p><code>ORC</code> file format provides a <em>highly efficient way to store data</em></p></li>
<li><p>It is a <em>raw columnar data format</em> highly optimized for reading, writing, and processing data in <code>Hive</code></p></li>
<li><p>It stores data in a <em>compact way</em> and enables <em>skipping quickly irrelevant parts</em></p></li>
</ul>
</div><div class="column" style="width:40%;">
<div class="center">
<p><img data-src="../../images/orc.png"></p>
</div>
</div></div>
<aside class="notes">
<p>A few words about <code>Hive</code></p>
<p><a href="https://hive.apache.org">Hive official site</a></p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="about-orc-organization" class="slide level2 center">
<h2>About <code>ORC</code>: organization</h2>
<ul>
<li><p><code>ORC</code> stores <em>collections of rows in one file</em>. Within the collection, row data is stored in a <em>columnar format</em></p></li>
<li><p>An <code>ORC</code> file contains <strong>groups of row data</strong> called <em>stripes</em>, along with auxiliary information in a file footer. At the end of the file a postscript holds compression parameters and the size of the compressed footer</p></li>
<li><p>The default stripe size is 250 MB. <strong>Large stripe</strong> sizes enable <em>large, efficient reads from HDFS</em></p></li>
<li><p>The <strong>file footer</strong> contains a list of stripes in the file, the number of rows per stripe, and each column’s data type. It also contains column-level aggregates count, min, max, and sum</p></li>
</ul>
</section>
<section id="about-orc-onctinued" class="slide level2 center">
<h2>About <code>ORC</code> (onctinued)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p><strong>Index data</strong> include min and max values for each column and the row’s positions within each column</p></li>
<li><p><strong><code>ORC</code> indexes</strong> are used only for the selection of stripes and row groups and not for answering queries</p></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="../../images/orc-file-structure.png"></p>
<figcaption>ORC file structure</figcaption>
</figure>
</div>
</div></div>
<!-- end columns -->
</section>
<section id="about-orc" class="slide level2 center">
<h2>About <code>ORC</code></h2>
<p><code>ORC</code> file format has many advantages such as:</p>
<ul>
<li><p><code>Hive</code> type support including <code>DateTime</code>, <code>decimal</code>, and the complex types (<code>struct</code>, <code>list</code>, <code>map</code> and <code>union</code>)</p></li>
<li><p><strong>Concurrent reads</strong> of the same file</p></li>
<li><p>Ability to split files <strong>without scanning for markers</strong></p></li>
<li><p>Estimate an <strong>upper bound on heap memory allocation</strong> based on the information in the file footer.</p></li>
</ul>
</section></section>
<section>
<section id="comparison-between-formats" class="title-slide slide level1 center" data-background-color="#1c191c">
<h1>Comparison between formats</h1>

</section>
<section id="avro-versus-parquet" class="slide level2 center">
<h2><code>Avro</code> versus <code>Parquet</code></h2>
<ul>
<li><p><code>Avro</code> is a <em>row-based</em> storage format whereas <code>Parquet</code> is a <em>columnar based</em> storage format</p></li>
<li><p><code>Parquet</code> is much better for <em>analytical querying</em> i.e.&nbsp;reads and querying are much more efficient than writing.</p></li>
<li><p><strong>Write operations</strong> in <code>Avro</code> are better than in <code>Parquet</code>.</p></li>
<li><p><code>Avro</code> is more mature than <code>Parquet</code> for <em>schema evolution</em>: <code>Parquet</code> supports only <strong>schema append</strong> while <code>Avro</code> supports more things, such as <strong>adding or modifying columns</strong></p></li>
<li><p><code>Parquet</code> is ideal for <em>querying a subset of columns</em> in a multi-column table. <code>Avro</code> is ideal for <strong>operations where all the columns are needed</strong> (such as in a ETL workflow)</p></li>
</ul>
</section>
<section id="orc-vs-parquet" class="slide level2 center">
<h2><code>ORC</code> vs <code>Parquet</code></h2>
<ul>
<li><p><code>Parquet</code> is more capable of <em>storing nested data</em></p></li>
<li><p><code>ORC</code> is more capable of <em>predicate pushdown</em> (SQL queries on a data file are better optimized, chunks of data can be <strong>skipped</strong> directly while reading)</p></li>
<li><p><code>ORC</code> is more <em>compression efficient</em></p></li>
</ul>
</section>
<section id="in-summary" class="slide level2 center">
<h2>In summary…</h2>
<div class="center">
<p><img src="../../images/file-formats.png" style="width: 80%;"></p>
</div>
</section></section>
<section>
<section id="how-to-choose-a-file-format" class="title-slide slide level1 center" data-background-color="#1c191c">
<h1>How to choose a file format</h1>

</section>
<section id="r-ead-write-intensive-query-pattern" class="slide level2 center">
<h2>R ead / write intensive &amp; query pattern</h2>
<ul>
<li><p><strong>Row-based</strong> file formats are overall better for storing write-intensive data because <em>appending new records is easier</em></p></li>
<li><p>If only a <strong>small subset of columns</strong> is queried frequently, <em>columnar formats will be better</em> since only those needed columns will be accessed and transmitted (whereas row formats need to pull all the columns)</p></li>
</ul>
</section>
<section id="c-ompression" class="slide level2 center">
<h2>C ompression</h2>
<ul>
<li><p>Compression is one of the key aspects to consider since <em>compression helps reduce the resources</em> required to store and transmit data</p></li>
<li><p><em>Columnar formats are better than row-based formats in terms of compression</em> because <strong>storing the same type of values together allows more efficient compression</strong></p></li>
<li><p>In columnar formats, <strong>a different and efficient encoding is utilized for each column</strong></p></li>
<li><p><code>ORC</code> has the best compression rate of all three, thanks to its <strong>stripes</strong></p></li>
</ul>
</section>
<section id="s-chema-evolution" class="slide level2 center">
<h2>S chema Evolution</h2>
<ul>
<li><p>One challenge in big data is the <em>frequent change of data schema</em>: e.g.&nbsp;<strong>adding/dropping columns</strong> and changing columns names</p></li>
<li><p>If you know that the <strong>schema of the data will change</strong> several times, <em>the best choice is <code>Avro</code></em></p></li>
<li><p><code>Avro</code> data schema is in JSON and <code>Avro</code> is able to keep data compact even when many different schemas exist</p></li>
</ul>
<p>See <a href="https://spark.apache.org/docs/latest/sql-data-sources-parquet.html#schema-merging">Schema merging for parquet files</a></p>
</section>
<section id="n-ested-columns" class="slide level2 center">
<h2>N ested Columns</h2>
<ul>
<li><p>If you have a lot of <em>complex nested columns</em> in your dataset and often only query a <strong>subset of columns or subcolumns</strong>, <em>Parquet is the best choice</em></p></li>
<li><p>Parquet allows to <em>access and retrieve subcolumns without pulling the rest</em> of the nested column</p></li>
</ul>
</section>
<section id="f-ramework-support" class="slide level2 center">
<h2>F ramework support</h2>
<ul>
<li><p>You have <em>consider the framework</em> you are using when choosing a data format</p></li>
<li><p>Data formats <strong>perform differently</strong> depending on where they are used</p></li>
<li><p><code>ORC</code> works best with <a href=""><code>Hive</code> <i class="fa-brands fa-hive" aria-label="hive"></i></a> (it was designed for it)</p></li>
<li><p><code>Spark</code> provides great support for processing <code>Parquet</code> formats.</p></li>
<li><p><code>Avro</code> is often a good choice for <a href="https://kafka.apache.org"><code>Kafka</code></a> (streaming applications)</p></li>
</ul>
<p>But… you can <em>use an try all formats with any framework</em></p>
</section></section>
<section id="thank-you" class="title-slide slide level1 unlisted center" data-background-color="#1c191c">
<h1>Thank you !</h1>


<div class="reveal-header">
<div class="header-logo" data-header-logo-link="https://u-paris.fr">
<img data-src="../../images/logo.png">
</div>
<div class="sc-title">
<p> </p>
</div>
<div class="header-text">
<p> </p>
</div>
<div class="sb-title">
<p> </p>
</div>
</div>
</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><a href="http://s-v-b.github.io/IFEBY310">IFEBY030</a> – Technos Big Data – M1 MIDS/MFA/LOGOS – UParis Cité</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/s-v-b\.github\.io\/IFEBY310\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
              // target, if specified
              link.setAttribute("target", "_blank");
              if (link.getAttribute("rel") === null) {
                link.setAttribute("rel", "noopener");
              }
              // default icon
              link.classList.add("external");
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
          let selectedAnnoteEl;
          const selectorForAnnotation = ( cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' +  annotation + '"';
            const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
            return selector;
          }
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
            const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            })
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
                //compute the position of the single el (top and bottom and make a div)
                const el = window.document.getElementById(lineIds[0]);
                top = el.offsetTop;
                height = el.offsetHeight;
                parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it 
                let div = window.document.getElementById("code-annotation-line-highlight");
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = 'absolute';
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                  gutterDiv.style.position = 'absolute';
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector('.code-annotation-gutter');
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
          const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
          for (let i=0; i<annoteTargets.length; i++) {
            const annoteTarget = annoteTargets[i];
            const targetCell = annoteTarget.getAttribute("data-target-cell");
            const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
            const contentFn = () => {
              const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              if (content) {
                const tipContent = content.cloneNode(true);
                tipContent.classList.add("code-annotation-tip-content");
                return tipContent.outerHTML;
              }
            }
            const config = {
              allowHTML: true,
              content: contentFn,
              onShow: (instance) => {
                selectCodeLines(instance.reference);
                instance.reference.classList.add('code-annotation-active');
                window.tippy.hideAll();
              },
              onHide: (instance) => {
                unselectCodeLines();
                instance.reference.classList.remove('code-annotation-active');
              },
              maxWidth: 300,
              delay: [50, 0],
              duration: [200, 0],
              offset: [5, 10],
              arrow: true,
              appendTo: function(el) {
                return el.parentElement.parentElement.parentElement;
              },
              interactive: true,
              interactiveBorder: 10,
              theme: 'light-border',
              placement: 'right',
              popperOptions: {
                modifiers: [
                {
                  name: 'flip',
                  options: {
                    flipVariations: false, // true by default
                    allowedAutoPlacements: ['right'],
                    fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                  },
                },
                {
                  name: 'preventOverflow',
                  options: {
                    mainAxis: false,
                    altAxis: false
                  }
                }
                ]        
              }      
            };
            window.tippy(annoteTarget, config); 
          }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
        <script type="text/javascript">
        (function(d) {
          d.querySelectorAll(".pseudocode-container").forEach(function(el) {
            let pseudocodeOptions = {
              indentSize: el.dataset.indentSize || "1.2em",
              commentDelimiter: el.dataset.commentDelimiter || "//",
              lineNumber: el.dataset.lineNumber === "true" ? true : false,
              lineNumberPunc: el.dataset.lineNumberPunc || ":",
              noEnd: el.dataset.noEnd === "true" ? true : false,
              titlePrefix: el.dataset.captionPrefix || "Algorithm"
            };
            pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
          });
        })(document);
        (function(d) {
          d.querySelectorAll(".pseudocode-container").forEach(function(el) {
            let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
            if (captionSpan !== null) {
              let captionPrefix = el.dataset.captionPrefix + " ";
              let captionNumber = "";
              if (el.dataset.pseudocodeNumber) {
                captionNumber = el.dataset.pseudocodeNumber + " ";
                if (el.dataset.chapterLevel) {
                  captionNumber = el.dataset.chapterLevel + "." + captionNumber;
                }
              }
              captionSpan.innerHTML = captionPrefix + captionNumber;
            }
          });
        })(document);
        </script>
      
    

</body></html>