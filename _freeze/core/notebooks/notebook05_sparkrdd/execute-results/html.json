{
  "hash": "3b078cc4edc3d6c7aafdb3667e4155ca",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Introduction to `Spark` RDD\njupyter: python3\n---\n\n::: {#e1364170 .cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\n```\n:::\n\n\n::: {#ef44841e .cell execution_count=2}\n``` {.python .cell-code}\nimport os\nimport sys\nimport inspect\n\nos.environ['PYSPARK_PYTHON'] = sys.executable\nos.environ['PYSPARK_DRIVER_PYTHON'] = sys.executable\n```\n:::\n\n\n::: {#6a3fd5aa .cell execution_count=3}\n``` {.python .cell-code}\nfrom pyspark import SparkConf, SparkContext\n\nconf = SparkConf().setAppName(\"Spark RDD Course\")\nsc = SparkContext(conf=conf)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">ValueError</span>                                Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[75], line 4</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">pyspark</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> SparkConf, SparkContext\n<span class=\"ansi-green-fg ansi-bold\">      3</span> conf <span style=\"color:rgb(98,98,98)\">=</span> SparkConf()<span style=\"color:rgb(98,98,98)\">.</span>setAppName(<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Spark RDD Course</span><span style=\"color:rgb(175,0,0)\">\"</span>)\n<span class=\"ansi-green-fg\">----&gt; 4</span> sc <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">SparkContext</span><span class=\"ansi-yellow-bg\">(</span><span class=\"ansi-yellow-bg\">conf</span><span style=\"color:rgb(98,98,98)\" class=\"ansi-yellow-bg\">=</span><span class=\"ansi-yellow-bg\">conf</span><span class=\"ansi-yellow-bg\">)</span>\n\nFile <span class=\"ansi-green-fg\">~/Documents/IFEBY310/.venv/lib/python3.12/site-packages/pyspark/core/context.py:206</span>, in <span class=\"ansi-cyan-fg\">SparkContext.__init__</span><span class=\"ansi-blue-fg\">(self, master, appName, sparkHome, pyFiles, environment, batchSize, serializer, conf, gateway, jsc, profiler_cls, udf_profiler_cls, memory_profiler_cls)</span>\n<span class=\"ansi-green-fg ansi-bold\">    200</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> gateway <span style=\"font-weight:bold;color:rgb(175,0,255)\">is</span> <span style=\"font-weight:bold;color:rgb(175,0,255)\">not</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span> <span style=\"font-weight:bold;color:rgb(175,0,255)\">and</span> gateway<span style=\"color:rgb(98,98,98)\">.</span>gateway_parameters<span style=\"color:rgb(98,98,98)\">.</span>auth_token <span style=\"font-weight:bold;color:rgb(175,0,255)\">is</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>:\n<span class=\"ansi-green-fg ansi-bold\">    201</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">raise</span> <span style=\"font-weight:bold;color:rgb(215,95,95)\">ValueError</span>(\n<span class=\"ansi-green-fg ansi-bold\">    202</span>         <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">You are trying to pass an insecure Py4j gateway to Spark. This</span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">    203</span>         <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\"> is not allowed as it is a security risk.</span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">    204</span>     )\n<span class=\"ansi-green-fg\">--&gt; 206</span> <span class=\"ansi-yellow-bg\">SparkContext</span><span style=\"color:rgb(98,98,98)\" class=\"ansi-yellow-bg\">.</span><span class=\"ansi-yellow-bg\">_ensure_initialized</span><span class=\"ansi-yellow-bg\">(</span><span style=\"color:rgb(0,135,0)\" class=\"ansi-yellow-bg\">self</span><span class=\"ansi-yellow-bg\">,</span><span class=\"ansi-yellow-bg\"> </span><span class=\"ansi-yellow-bg\">gateway</span><span style=\"color:rgb(98,98,98)\" class=\"ansi-yellow-bg\">=</span><span class=\"ansi-yellow-bg\">gateway</span><span class=\"ansi-yellow-bg\">,</span><span class=\"ansi-yellow-bg\"> </span><span class=\"ansi-yellow-bg\">conf</span><span style=\"color:rgb(98,98,98)\" class=\"ansi-yellow-bg\">=</span><span class=\"ansi-yellow-bg\">conf</span><span class=\"ansi-yellow-bg\">)</span>\n<span class=\"ansi-green-fg ansi-bold\">    207</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">try</span>:\n<span class=\"ansi-green-fg ansi-bold\">    208</span>     <span style=\"color:rgb(0,135,0)\">self</span><span style=\"color:rgb(98,98,98)\">.</span>_do_init(\n<span class=\"ansi-green-fg ansi-bold\">    209</span>         master,\n<span class=\"ansi-green-fg ansi-bold\">    210</span>         appName,\n<span class=\"ansi-green-fg\">   (...)</span>\n<span class=\"ansi-green-fg ansi-bold\">    220</span>         memory_profiler_cls,\n<span class=\"ansi-green-fg ansi-bold\">    221</span>     )\n\nFile <span class=\"ansi-green-fg\">~/Documents/IFEBY310/.venv/lib/python3.12/site-packages/pyspark/core/context.py:476</span>, in <span class=\"ansi-cyan-fg\">SparkContext._ensure_initialized</span><span class=\"ansi-blue-fg\">(cls, instance, gateway, conf)</span>\n<span class=\"ansi-green-fg ansi-bold\">    473</span>     callsite <span style=\"color:rgb(98,98,98)\">=</span> SparkContext<span style=\"color:rgb(98,98,98)\">.</span>_active_spark_context<span style=\"color:rgb(98,98,98)\">.</span>_callsite\n<span class=\"ansi-green-fg ansi-bold\">    475</span>     <span style=\"font-style:italic;color:rgb(95,135,135)\"># Raise error if there is already a running Spark context</span>\n<span class=\"ansi-green-fg\">--&gt; 476</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">raise</span> <span style=\"font-weight:bold;color:rgb(215,95,95)\">ValueError</span>(\n<span class=\"ansi-green-fg ansi-bold\">    477</span>         <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Cannot run multiple SparkContexts at once; </span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">    478</span>         <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">existing SparkContext(app=</span><span style=\"font-weight:bold;color:rgb(175,95,135)\">%s</span><span style=\"color:rgb(175,0,0)\">, master=</span><span style=\"font-weight:bold;color:rgb(175,95,135)\">%s</span><span style=\"color:rgb(175,0,0)\">)</span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">    479</span>         <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\"> created by </span><span style=\"font-weight:bold;color:rgb(175,95,135)\">%s</span><span style=\"color:rgb(175,0,0)\"> at </span><span style=\"font-weight:bold;color:rgb(175,95,135)\">%s</span><span style=\"color:rgb(175,0,0)\">:</span><span style=\"font-weight:bold;color:rgb(175,95,135)\">%s</span><span style=\"color:rgb(175,0,0)\"> </span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">    480</span>         <span style=\"color:rgb(98,98,98)\">%</span> (\n<span class=\"ansi-green-fg ansi-bold\">    481</span>             currentAppName,\n<span class=\"ansi-green-fg ansi-bold\">    482</span>             currentMaster,\n<span class=\"ansi-green-fg ansi-bold\">    483</span>             callsite<span style=\"color:rgb(98,98,98)\">.</span>function,\n<span class=\"ansi-green-fg ansi-bold\">    484</span>             callsite<span style=\"color:rgb(98,98,98)\">.</span>file,\n<span class=\"ansi-green-fg ansi-bold\">    485</span>             callsite<span style=\"color:rgb(98,98,98)\">.</span>linenum,\n<span class=\"ansi-green-fg ansi-bold\">    486</span>         )\n<span class=\"ansi-green-fg ansi-bold\">    487</span>     )\n<span class=\"ansi-green-fg ansi-bold\">    488</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">else</span>:\n<span class=\"ansi-green-fg ansi-bold\">    489</span>     SparkContext<span style=\"color:rgb(98,98,98)\">.</span>_active_spark_context <span style=\"color:rgb(98,98,98)\">=</span> instance\n\n<span class=\"ansi-red-fg\">ValueError</span>: Cannot run multiple SparkContexts at once; existing SparkContext(app=Spark RDD Course, master=local[*]) created by __init__ at /tmp/ipykernel_120359/4031476840.py:4 </pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#fc8ebc13 .cell execution_count=4}\n``` {.python .cell-code}\nrdd = sc.parallelize(range(64))\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[76], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">64</span>))\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\nNote that `parallelize` takes an optional argument to choose the number of partitions\n\n::: {#5f61f5e4 .cell execution_count=5}\n``` {.python .cell-code}\nrdd.getNumPartitions()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[77], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>getNumPartitions()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#99fc5df0 .cell execution_count=6}\n``` {.python .cell-code}\nrdd = sc.parallelize(range(1000), 10)\nrdd.getNumPartitions()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[78], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1000</span>), <span style=\"color:rgb(98,98,98)\">10</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>getNumPartitions()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n## Transformations\n\n### `map`\n\n::: {#c8217049 .cell execution_count=7}\n``` {.python .cell-code}\nrdd = sc.parallelize([2, 3, 4])\nrdd = rdd.map(lambda x: list(range(1, x)))\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[79], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">4</span>])\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>map(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x: <span style=\"color:rgb(0,135,0)\">list</span>(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, x)))\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#0cd32559 .cell execution_count=8}\n``` {.python .cell-code}\nrdd\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[80], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#0febf4ff .cell execution_count=9}\n``` {.python .cell-code}\n(\n    sc.parallelize([2, 3, 4])\n      .map(lambda x: list(range(1, x)))\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[81], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> (\n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">4</span>])\n<span class=\"ansi-green-fg ansi-bold\">      3</span>       <span style=\"color:rgb(98,98,98)\">.</span>map(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x: <span style=\"color:rgb(0,135,0)\">list</span>(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, x)))\n<span class=\"ansi-green-fg ansi-bold\">      4</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n`map` is a *transformation*. It is *lazily* evaluated. Hence execution is delayed until an *action* is met in the DAG).\n\n::: {#df37a23e .cell execution_count=10}\n``` {.python .cell-code}\nrdd.collect()  # collect is an action \n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[82], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>collect()  <span style=\"font-style:italic;color:rgb(95,135,135)\"># collect is an action </span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#b556dd90 .cell execution_count=11}\n``` {.python .cell-code}\n(\n    sc.parallelize([2, 3, 4])\n      .map(lambda x: list(range(1, x)))\n      .collect()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[83], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> (\n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">4</span>])\n<span class=\"ansi-green-fg ansi-bold\">      3</span>       <span style=\"color:rgb(98,98,98)\">.</span>map(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x: <span style=\"color:rgb(0,135,0)\">list</span>(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, x)))\n<span class=\"ansi-green-fg ansi-bold\">      4</span>       <span style=\"color:rgb(98,98,98)\">.</span>collect()\n<span class=\"ansi-green-fg ansi-bold\">      5</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### Exercice: `map` with a method\n\n**Warning.** This example is a bad practice !!! Don't do this at home\n\n::: {#a44b4c7a .cell execution_count=12}\n``` {.python .cell-code}\ndbtel = {'arthur': 1234, 'riad': 4567, 'anatole': 3615}\n```\n:::\n\n\n::: {#fd02011a .cell execution_count=13}\n``` {.python .cell-code}\nclass TelephoneDB(object):\n    \n    def __init__(self):\n        self.tel = {'arthur': 1234, 'riad': 4567, 'anatole': 3615}\n   \n    def add_tel(self, name):\n        return name, self.tel.get(name)\n```\n:::\n\n\n::: {#68859868 .cell execution_count=14}\n``` {.python .cell-code}\ntel_db = TelephoneDB()\nnames = ['arthur', 'riad']\n```\n:::\n\n\n::: {#97a87c10 .cell execution_count=15}\n``` {.python .cell-code}\nrdd = (\n    sc\n        .parallelize(names)\n        .map(tel_db.add_tel)\n        .collect()\n)\n\nrdd\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[87], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> (\n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">sc</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span>         <span style=\"color:rgb(98,98,98)\">.</span>parallelize(names)\n<span class=\"ansi-green-fg ansi-bold\">      4</span>         <span style=\"color:rgb(98,98,98)\">.</span>map(tel_db<span style=\"color:rgb(98,98,98)\">.</span>add_tel)\n<span class=\"ansi-green-fg ansi-bold\">      5</span>         <span style=\"color:rgb(98,98,98)\">.</span>collect()\n<span class=\"ansi-green-fg ansi-bold\">      6</span> )\n<span class=\"ansi-green-fg ansi-bold\">      8</span> rdd\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n- Replace the `tel` dictionary by a `defaultdict` with default number `999` \n- Use it on a `rdd` containing names as above including an unknown one, and try it\n\n::: {#7c99e7d6 .cell execution_count=16}\n``` {.python .cell-code}\nfrom collections import defaultdict\n\nclass TelephoneDefaultDB(object):\n    \n    def __init__(self):\n        self.tel = defaultdict(lambda: 999, {'arthur': 1234, 'riad': 4567, 'anatole': 3615})\n    \n    def add_tel(self, name):\n        return name, self.tel[name]\n    \n    def add_tel_rdd(self, rdd):  \n        return rdd.map(self.add_tel)\n```\n:::\n\n\n::: {#d029c57a .cell execution_count=17}\n``` {.python .cell-code}\ntel_db = TelephoneDefaultDB()\nnames = ['riad', 'anatole', 'yiyang']\nrdd = (\n    sc\n        .parallelize(names)\n        .map(tel_db.add_tel)\n        .collect()\n)\nrdd\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[89], line 4</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> tel_db <span style=\"color:rgb(98,98,98)\">=</span> TelephoneDefaultDB()\n<span class=\"ansi-green-fg ansi-bold\">      2</span> names <span style=\"color:rgb(98,98,98)\">=</span> [<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">riad</span><span style=\"color:rgb(175,0,0)\">'</span>, <span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">anatole</span><span style=\"color:rgb(175,0,0)\">'</span>, <span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">yiyang</span><span style=\"color:rgb(175,0,0)\">'</span>]\n<span class=\"ansi-green-fg ansi-bold\">      3</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> (\n<span class=\"ansi-green-fg\">----&gt; 4</span>     <span class=\"ansi-yellow-bg\">sc</span>\n<span class=\"ansi-green-fg ansi-bold\">      5</span>         <span style=\"color:rgb(98,98,98)\">.</span>parallelize(names)\n<span class=\"ansi-green-fg ansi-bold\">      6</span>         <span style=\"color:rgb(98,98,98)\">.</span>map(tel_db<span style=\"color:rgb(98,98,98)\">.</span>add_tel)\n<span class=\"ansi-green-fg ansi-bold\">      7</span>         <span style=\"color:rgb(98,98,98)\">.</span>collect()\n<span class=\"ansi-green-fg ansi-bold\">      8</span> )\n<span class=\"ansi-green-fg ansi-bold\">      9</span> rdd\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {.callout-caution}\n\nIt is a bad idea to pass *methods* to spark's `map`.\nSince `add_tel` needs `self`, the whole object is serialized so that `spark` can use it.\n\nThis breaks if the `tel` is large, or if it is not serializable.\n\n:::\n\n### `flatMap`\n\n::: {#28e5b326 .cell execution_count=18}\n``` {.python .cell-code}\nrdd = sc.parallelize([2, 3, 4, 5])\n( \n    rdd\n        .flatMap(lambda x: range(1, x))\n        .collect()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[90], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">4</span>, <span style=\"color:rgb(98,98,98)\">5</span>])\n<span class=\"ansi-green-fg ansi-bold\">      2</span> ( \n<span class=\"ansi-green-fg ansi-bold\">      3</span>     rdd\n<span class=\"ansi-green-fg ansi-bold\">      4</span>         <span style=\"color:rgb(98,98,98)\">.</span>flatMap(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x: <span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, x))\n<span class=\"ansi-green-fg ansi-bold\">      5</span>         <span style=\"color:rgb(98,98,98)\">.</span>collect()\n<span class=\"ansi-green-fg ansi-bold\">      6</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `filter`\n\n::: {#d494253f .cell execution_count=19}\n``` {.python .cell-code}\nrdd = sc.parallelize(range(10))\n\nrdd\\\n    .filter(lambda x: x % 2 == 0)\\\n    .collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[91], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">10</span>))\n<span class=\"ansi-green-fg ansi-bold\">      3</span> rdd\\\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     <span style=\"color:rgb(98,98,98)\">.</span>filter(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x: x <span style=\"color:rgb(98,98,98)\">%</span> <span style=\"color:rgb(98,98,98)\">2</span> <span style=\"color:rgb(98,98,98)\">==</span> <span style=\"color:rgb(98,98,98)\">0</span>)\\\n<span class=\"ansi-green-fg ansi-bold\">      5</span>     <span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `distinct`\n\n::: {#c75900a3 .cell execution_count=20}\n``` {.python .cell-code}\nrdd = sc.parallelize([1, 1, 4, 2, 1, 3, 3])\nrdd.distinct().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[92], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">4</span>, <span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">3</span>])\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>distinct()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### \"Pseudo-set\" operations\n\n::: {#334bbdd1 .cell execution_count=21}\n``` {.python .cell-code}\nrdd1 = sc.parallelize(range(5))\nrdd2 = sc.parallelize(range(3, 9))\nrdd3 = rdd1.union(rdd2)\nrdd3.collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[93], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd1 <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">5</span>))\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd2 <span style=\"color:rgb(98,98,98)\">=</span> sc<span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">9</span>))\n<span class=\"ansi-green-fg ansi-bold\">      3</span> rdd3 <span style=\"color:rgb(98,98,98)\">=</span> rdd1<span style=\"color:rgb(98,98,98)\">.</span>union(rdd2)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#f5cc9cc8 .cell execution_count=22}\n``` {.python .cell-code}\nrdd3.distinct().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[94], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd3</span><span style=\"color:rgb(98,98,98)\">.</span>distinct()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd3' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#e58eec19 .cell execution_count=23}\n``` {.python .cell-code}\nrdd1 = sc.parallelize([1, 2])\nrdd2 = sc.parallelize([\"a\", \"b\"])\nrdd1.cartesian(rdd2).collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[95], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd1 <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">2</span>])\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd2 <span style=\"color:rgb(98,98,98)\">=</span> sc<span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">\"</span>])\n<span class=\"ansi-green-fg ansi-bold\">      3</span> rdd1<span style=\"color:rgb(98,98,98)\">.</span>cartesian(rdd2)<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n## Actions\n\n`collect` is obviously an action...\n\n### `count`, `countByValue`\n\n::: {#3d048380 .cell execution_count=24}\n``` {.python .cell-code}\nrdd = sc.parallelize([1, 3, 1, 2, 2, 2])\nrdd.count()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[96], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">2</span>])\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>count()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#1e534d92 .cell execution_count=25}\n``` {.python .cell-code}\nrdd.countByValue()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[97], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>countByValue()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\nWhy does `countByValue()` returns a dictionary?\n\nAre `count()` and `countByValue()` actions or transformations?\n\n::: {#fb12281e .cell execution_count=26}\n``` {.python .cell-code}\nu = np.int32((np.random.sample(100000) * 100000))  # 100000 random integers uniformly distributed on 0, ..., 100000\n\np = (\n    sc.parallelize(u)\n    .countByValue()\n)\n\nq = sorted(\n    p.items(), \n    key = lambda x : x[1], \n    reverse=True\n)\n\nq[0:10]\n\nq[0], 1 + np.log(len(u))/ np.log(np.log(len(u))), len(q)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[98], line 4</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> u <span style=\"color:rgb(98,98,98)\">=</span> np<span style=\"color:rgb(98,98,98)\">.</span>int32((np<span style=\"color:rgb(98,98,98)\">.</span>random<span style=\"color:rgb(98,98,98)\">.</span>sample(<span style=\"color:rgb(98,98,98)\">100000</span>) <span style=\"color:rgb(98,98,98)\">*</span> <span style=\"color:rgb(98,98,98)\">100000</span>))  <span style=\"font-style:italic;color:rgb(95,135,135)\"># 100000 random integers uniformly distributed on 0, ..., 100000</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span> p <span style=\"color:rgb(98,98,98)\">=</span> (\n<span class=\"ansi-green-fg\">----&gt; 4</span>     <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(u)\n<span class=\"ansi-green-fg ansi-bold\">      5</span>     <span style=\"color:rgb(98,98,98)\">.</span>countByValue()\n<span class=\"ansi-green-fg ansi-bold\">      6</span> )\n<span class=\"ansi-green-fg ansi-bold\">      8</span> q <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(0,135,0)\">sorted</span>(\n<span class=\"ansi-green-fg ansi-bold\">      9</span>     p<span style=\"color:rgb(98,98,98)\">.</span>items(), \n<span class=\"ansi-green-fg ansi-bold\">     10</span>     key <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x : x[<span style=\"color:rgb(98,98,98)\">1</span>], \n<span class=\"ansi-green-fg ansi-bold\">     11</span>     reverse<span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">True</span>\n<span class=\"ansi-green-fg ansi-bold\">     12</span> )\n<span class=\"ansi-green-fg ansi-bold\">     14</span> q[<span style=\"color:rgb(98,98,98)\">0</span>:<span style=\"color:rgb(98,98,98)\">10</span>]\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n- How many distinct values do you expect in `u` ?\n- How large is the largest value in $q$ ?\n\n::: {#077fd6a7 .cell execution_count=27}\n``` {.python .cell-code}\nfrom scipy.stats import poisson \n\n( \n    len(q), \n    (1-np.exp(-1)) * len(u),\n    poisson.ppf(1.-1./len(u), 1)\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[99], line 4</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">scipy</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">stats</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> poisson \n<span class=\"ansi-green-fg ansi-bold\">      3</span> ( \n<span class=\"ansi-green-fg\">----&gt; 4</span>     <span style=\"color:rgb(0,135,0)\">len</span>(<span class=\"ansi-yellow-bg\">q</span>), \n<span class=\"ansi-green-fg ansi-bold\">      5</span>     (<span style=\"color:rgb(98,98,98)\">1</span><span style=\"color:rgb(98,98,98)\">-</span>np<span style=\"color:rgb(98,98,98)\">.</span>exp(<span style=\"color:rgb(98,98,98)\">-</span><span style=\"color:rgb(98,98,98)\">1</span>)) <span style=\"color:rgb(98,98,98)\">*</span> <span style=\"color:rgb(0,135,0)\">len</span>(u),\n<span class=\"ansi-green-fg ansi-bold\">      6</span>     poisson<span style=\"color:rgb(98,98,98)\">.</span>ppf(<span style=\"color:rgb(98,98,98)\">1.</span><span style=\"color:rgb(98,98,98)\">-</span><span style=\"color:rgb(98,98,98)\">1.</span><span style=\"color:rgb(98,98,98)\">/</span><span style=\"color:rgb(0,135,0)\">len</span>(u), <span style=\"color:rgb(98,98,98)\">1</span>)\n<span class=\"ansi-green-fg ansi-bold\">      7</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'q' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `take`, `takeOrdered`\n\n::: {#ade4bdb0 .cell execution_count=28}\n``` {.python .cell-code}\nrdd = sc.parallelize([(3, 'a'), (1, 'b'), (2, 'd')])\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[100], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([(<span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">'</span>), (<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">'</span>), (<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">d</span><span style=\"color:rgb(175,0,0)\">'</span>)])\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#79ac6ccc .cell execution_count=29}\n``` {.python .cell-code}\n(1, 'b') <=  (2, 'd') <= (3, 'a')\n```\n\n::: {.cell-output .cell-output-display execution_count=101}\n```\nTrue\n```\n:::\n:::\n\n\n::: {#9eaf562c .cell execution_count=30}\n``` {.python .cell-code}\nrdd.takeOrdered(2)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[102], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>takeOrdered(<span style=\"color:rgb(98,98,98)\">2</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#477ceba0 .cell execution_count=31}\n``` {.python .cell-code}\nrdd.takeOrdered(2, key=lambda x: x[1])\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[103], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>takeOrdered(<span style=\"color:rgb(98,98,98)\">2</span>, key<span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x: x[<span style=\"color:rgb(98,98,98)\">1</span>])\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `reduce`, `fold`\n\n::: {#cb0c69c5 .cell execution_count=32}\n``` {.python .cell-code}\nrdd = sc.range(1, 4)\nrdd.reduce(lambda a, b: a + b)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[104], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>range(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">4</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>reduce(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#58696b8e .cell execution_count=33}\n``` {.python .cell-code}\nrdd = sc.range(1, 4, numSlices=7)\nrdd.reduce(lambda a, b: a + b)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[105], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>range(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">4</span>, numSlices<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">7</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>reduce(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#6719ce43 .cell execution_count=34}\n``` {.python .cell-code}\nrdd = sc.parallelize(range(1,4), 3)\nrdd.reduce(lambda a, b: a + b)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[106], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>,<span style=\"color:rgb(98,98,98)\">4</span>), <span style=\"color:rgb(98,98,98)\">3</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>reduce(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#0042ca76 .cell execution_count=35}\n``` {.python .cell-code}\n( \n    sc.parallelize(range(1, 4), 2)\n      .fold(0, lambda a, b: a + b)\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[107], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> ( \n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">4</span>), <span style=\"color:rgb(98,98,98)\">2</span>)\n<span class=\"ansi-green-fg ansi-bold\">      3</span>       <span style=\"color:rgb(98,98,98)\">.</span>fold(<span style=\"color:rgb(98,98,98)\">0</span>, <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)\n<span class=\"ansi-green-fg ansi-bold\">      4</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#17a2119f .cell execution_count=36}\n``` {.python .cell-code}\n( \n    sc.parallelize(range(1, 4), 1)\n      .fold(3, lambda a, b: a + b)\n),( \n    sc.parallelize(range(1, 4), 2)\n      .fold(2, lambda a, b: a + b)\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[108], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> ( \n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">4</span>), <span style=\"color:rgb(98,98,98)\">1</span>)\n<span class=\"ansi-green-fg ansi-bold\">      3</span>       <span style=\"color:rgb(98,98,98)\">.</span>fold(<span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)\n<span class=\"ansi-green-fg ansi-bold\">      4</span> ),( \n<span class=\"ansi-green-fg ansi-bold\">      5</span>     sc<span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">4</span>), <span style=\"color:rgb(98,98,98)\">2</span>)\n<span class=\"ansi-green-fg ansi-bold\">      6</span>       <span style=\"color:rgb(98,98,98)\">.</span>fold(<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)\n<span class=\"ansi-green-fg ansi-bold\">      7</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#227f2c20 .cell execution_count=37}\n``` {.python .cell-code}\nrdd =  sc.parallelize(range(1, 4),3)\n( \n    rdd.fold(1, lambda a, b: a + b), \n    rdd.getNumPartitions()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[109], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span>  <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">4</span>),<span style=\"color:rgb(98,98,98)\">3</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> ( \n<span class=\"ansi-green-fg ansi-bold\">      3</span>     rdd<span style=\"color:rgb(98,98,98)\">.</span>fold(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b), \n<span class=\"ansi-green-fg ansi-bold\">      4</span>     rdd<span style=\"color:rgb(98,98,98)\">.</span>getNumPartitions()\n<span class=\"ansi-green-fg ansi-bold\">      5</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#69ebc35f .cell execution_count=38}\n``` {.python .cell-code}\nrdd =  sc.parallelize(range(1, 4),4)\n\n(\n    rdd.fold(1, lambda a, b: a + b), \n    rdd.getNumPartitions()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[110], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span>  <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize(<span style=\"color:rgb(0,135,0)\">range</span>(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">4</span>),<span style=\"color:rgb(98,98,98)\">4</span>)\n<span class=\"ansi-green-fg ansi-bold\">      3</span> (\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     rdd<span style=\"color:rgb(98,98,98)\">.</span>fold(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b), \n<span class=\"ansi-green-fg ansi-bold\">      5</span>     rdd<span style=\"color:rgb(98,98,98)\">.</span>getNumPartitions()\n<span class=\"ansi-green-fg ansi-bold\">      6</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#8cc6c7b7 .cell execution_count=39}\n``` {.python .cell-code}\nrdd = sc.parallelize([1, 2, 4], 2)\nrdd.fold(2, lambda a, b: a + b)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[111], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">4</span>], <span style=\"color:rgb(98,98,98)\">2</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>fold(<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#08ff7a73 .cell execution_count=40}\n``` {.python .cell-code}\nrdd = sc.parallelize([1, 2, 4], 3)\nrdd.fold(2, lambda a, b: a + b)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[112], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">4</span>], <span style=\"color:rgb(98,98,98)\">3</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>fold(<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#2d26f5de .cell execution_count=41}\n``` {.python .cell-code}\nrdd.getNumPartitions()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[113], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>getNumPartitions()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `aggregate`\n\n::: {#11a42182 .cell execution_count=42}\n``` {.python .cell-code}\nseqOp = lambda x, y: (x[0] + y, x[1] + 1)\ncombOp = lambda x, y: (x[0] + y[0], x[1] + y[1])\n\nrdd = sc.parallelize([1, 2, 3, 4], 8)\n(\n    rdd.aggregate((0, 0), seqOp, combOp), rdd.getNumPartitions()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[114], line 4</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> seqOp <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x, y: (x[<span style=\"color:rgb(98,98,98)\">0</span>] <span style=\"color:rgb(98,98,98)\">+</span> y, x[<span style=\"color:rgb(98,98,98)\">1</span>] <span style=\"color:rgb(98,98,98)\">+</span> <span style=\"color:rgb(98,98,98)\">1</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> combOp <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x, y: (x[<span style=\"color:rgb(98,98,98)\">0</span>] <span style=\"color:rgb(98,98,98)\">+</span> y[<span style=\"color:rgb(98,98,98)\">0</span>], x[<span style=\"color:rgb(98,98,98)\">1</span>] <span style=\"color:rgb(98,98,98)\">+</span> y[<span style=\"color:rgb(98,98,98)\">1</span>])\n<span class=\"ansi-green-fg\">----&gt; 4</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">4</span>], <span style=\"color:rgb(98,98,98)\">8</span>)\n<span class=\"ansi-green-fg ansi-bold\">      5</span> (\n<span class=\"ansi-green-fg ansi-bold\">      6</span>     rdd<span style=\"color:rgb(98,98,98)\">.</span>aggregate((<span style=\"color:rgb(98,98,98)\">0</span>, <span style=\"color:rgb(98,98,98)\">0</span>), seqOp, combOp), rdd<span style=\"color:rgb(98,98,98)\">.</span>getNumPartitions()\n<span class=\"ansi-green-fg ansi-bold\">      7</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#a556b45b .cell execution_count=43}\n``` {.python .cell-code}\nop = lambda x, y: x+y\nrdd = sc.parallelize([1, 2, 3, 4], 4)\n(\n    rdd.aggregate(0, op, op),\n    rdd.getNumPartitions()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[115], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> op <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x, y: x<span style=\"color:rgb(98,98,98)\">+</span>y\n<span class=\"ansi-green-fg\">----&gt; 2</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"color:rgb(98,98,98)\">4</span>], <span style=\"color:rgb(98,98,98)\">4</span>)\n<span class=\"ansi-green-fg ansi-bold\">      3</span> (\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     rdd<span style=\"color:rgb(98,98,98)\">.</span>aggregate(<span style=\"color:rgb(98,98,98)\">0</span>, op, op),\n<span class=\"ansi-green-fg ansi-bold\">      5</span>     rdd<span style=\"color:rgb(98,98,98)\">.</span>getNumPartitions()\n<span class=\"ansi-green-fg ansi-bold\">      6</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### Exercice: sum of powers with `aggregate`\n\n- Using `aggregate`, compute the sum, the sum of squares $x^2$ and the sum of cubes $x^3$ for \n$x \\in \\{1, \\ldots, 10 \\}$.\n- Check your computations using `numpy`\n\n::: {#b6e291a0 .cell execution_count=44}\n``` {.python .cell-code}\nseqOp = lambda x, y: (x[0] + y, x[1] + y ** 2, x[2] + y ** 3)\n```\n:::\n\n\n::: {#b60d2b4b .cell execution_count=45}\n``` {.python .cell-code}\ncombOp = lambda x, y: (x[0] + y[0], x[1] + y[1], x[2] + y[2])\n```\n:::\n\n\n::: {#f884c91b .cell execution_count=46}\n``` {.python .cell-code}\nsc.range(5)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[118], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>range(<span style=\"color:rgb(98,98,98)\">5</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#dec0672a .cell execution_count=47}\n``` {.python .cell-code}\n( \n    sc\n        .range(1, 11)\n        .aggregate((0, 0, 0), seqOp, combOp)\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[119], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> ( \n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">sc</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span>         <span style=\"color:rgb(98,98,98)\">.</span>range(<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(98,98,98)\">11</span>)\n<span class=\"ansi-green-fg ansi-bold\">      4</span>         <span style=\"color:rgb(98,98,98)\">.</span>aggregate((<span style=\"color:rgb(98,98,98)\">0</span>, <span style=\"color:rgb(98,98,98)\">0</span>, <span style=\"color:rgb(98,98,98)\">0</span>), seqOp, combOp)\n<span class=\"ansi-green-fg ansi-bold\">      5</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#816c5981 .cell execution_count=48}\n``` {.python .cell-code}\nimport numpy as np\n\nx = np.arange(1, 11)\nx\n```\n\n::: {.cell-output .cell-output-display execution_count=120}\n```\narray([ 1,  2,  3,  4,  5,  6,  7,  8,  9, 10])\n```\n:::\n:::\n\n\n::: {#644b9e15 .cell execution_count=49}\n``` {.python .cell-code}\nx.sum(), (x**2).sum(), (x**3).sum(), x.cumsum()\n```\n\n::: {.cell-output .cell-output-display execution_count=121}\n```\n(np.int64(55),\n np.int64(385),\n np.int64(3025),\n array([ 1,  3,  6, 10, 15, 21, 28, 36, 45, 55]))\n```\n:::\n:::\n\n\n### Computing an empirical variance with `aggregate`\n\nAssume a sample is stored as a RDD. Using `aggregate`, compute the sample variance $\\frac{1}{n}\\sum_{i=1}^n (x_i - \\overline{X}_n)^2$ where $\\overline{X}_n = \\frac{1}{n} \\sum_{i=1}^n x_i$ \n\n# `PairRDD`\n\n::: {#2df30912 .cell execution_count=50}\n``` {.python .cell-code}\nrdd = sc.parallelize([[1, \"a\", 7], [2, \"b\", 13], [2, \"c\", 17]])\n\nrdd.collect()  # not yet \n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[122], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([[<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">7</span>], [<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">13</span>], [<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">c</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">17</span>]])\n<span class=\"ansi-green-fg ansi-bold\">      3</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>collect()  <span style=\"font-style:italic;color:rgb(95,135,135)\"># not yet </span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#41cb40d1 .cell execution_count=51}\n``` {.python .cell-code}\nrdd = rdd.map(lambda x: (x[0], x[1:]))\n\nrdd.collect()  # done \n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[123], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>map(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x: (x[<span style=\"color:rgb(98,98,98)\">0</span>], x[<span style=\"color:rgb(98,98,98)\">1</span>:]))\n<span class=\"ansi-green-fg ansi-bold\">      3</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>collect()  <span style=\"font-style:italic;color:rgb(95,135,135)\"># done </span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n## Transformations\n\n### `keys`, `values`\n\n::: {#3ba5dc1a .cell execution_count=52}\n``` {.python .cell-code}\nrdd.keys().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[124], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>keys()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#2e359ce5 .cell execution_count=53}\n``` {.python .cell-code}\nrdd.values().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[125], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>values()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {.callout-warning}\n\nAll elements must be tuples with two elements (key and  value)\n:::\n\n::: {#d00975c8 .cell execution_count=54}\n``` {.python .cell-code}\nrdd = sc.parallelize([[1, \"a\", 7], [2, \"b\", 13], [2, \"c\", 17]])\nrdd.keys().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[126], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([[<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">7</span>], [<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">13</span>], [<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">c</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">17</span>]])\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>keys()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#57ba3213 .cell execution_count=55}\n``` {.python .cell-code}\nrdd.values().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[127], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>values()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\nThe values are *not* what we expected wrong... so we *must* do\n\n::: {#82eeff67 .cell execution_count=56}\n``` {.python .cell-code}\nrdd = ( sc.parallelize([[1, \"a\", 7], [2, \"b\", 13], [2, \"c\", 17]])\n          .map(lambda x: (x[0], x[1:]))\n      )\nrdd.keys().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[128], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> ( <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([[<span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">7</span>], [<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">13</span>], [<span style=\"color:rgb(98,98,98)\">2</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">c</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">17</span>]])\n<span class=\"ansi-green-fg ansi-bold\">      2</span>           <span style=\"color:rgb(98,98,98)\">.</span>map(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> x: (x[<span style=\"color:rgb(98,98,98)\">0</span>], x[<span style=\"color:rgb(98,98,98)\">1</span>:]))\n<span class=\"ansi-green-fg ansi-bold\">      3</span>       )\n<span class=\"ansi-green-fg ansi-bold\">      4</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>keys()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#f1bcd801 .cell execution_count=57}\n``` {.python .cell-code}\nrdd.values().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[129], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>values()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\nNow, the values are correct. \n\n### `mapValues`, `flatMapValues`\n\n::: {#0fbbac77 .cell execution_count=58}\n``` {.python .cell-code}\nrdd = sc.parallelize([(\"a\", \"x y z\"), (\"b\", \"p r\")])\n\nrdd.mapValues(lambda v: v.split(' ')).collect(), rdd.collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[130], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([(<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">x y z</span><span style=\"color:rgb(175,0,0)\">\"</span>), (<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">p r</span><span style=\"color:rgb(175,0,0)\">\"</span>)])\n<span class=\"ansi-green-fg ansi-bold\">      3</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>mapValues(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> v: v<span style=\"color:rgb(98,98,98)\">.</span>split(<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\"> </span><span style=\"color:rgb(175,0,0)\">'</span>))<span style=\"color:rgb(98,98,98)\">.</span>collect(), rdd<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#c74d60a6 .cell execution_count=59}\n``` {.python .cell-code}\nrdd.flatMapValues(lambda v: v.split(' ')).collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[131], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>flatMapValues(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> v: v<span style=\"color:rgb(98,98,98)\">.</span>split(<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\"> </span><span style=\"color:rgb(175,0,0)\">'</span>))<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `groupByKey`\n\n::: {#6234acea .cell execution_count=60}\n``` {.python .cell-code}\nrdd = sc.parallelize([(\"a\", 1), (\"b\", 1), (\"a\", 1), (\"b\", 3), (\"c\", 42)])\n( \n    rdd.groupByKey()\n       .mapValues(list)\n       .collect()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[132], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([(<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">1</span>), (<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">1</span>), (<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">1</span>), (<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">3</span>), (<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">c</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">42</span>)])\n<span class=\"ansi-green-fg ansi-bold\">      2</span> ( \n<span class=\"ansi-green-fg ansi-bold\">      3</span>     rdd<span style=\"color:rgb(98,98,98)\">.</span>groupByKey()\n<span class=\"ansi-green-fg ansi-bold\">      4</span>        <span style=\"color:rgb(98,98,98)\">.</span>mapValues(<span style=\"color:rgb(0,135,0)\">list</span>)\n<span class=\"ansi-green-fg ansi-bold\">      5</span>        <span style=\"color:rgb(98,98,98)\">.</span>collect()\n<span class=\"ansi-green-fg ansi-bold\">      6</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#8d0237b3 .cell execution_count=61}\n``` {.python .cell-code}\nrdd.groupByKey().collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[133], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">rdd</span><span style=\"color:rgb(98,98,98)\">.</span>groupByKey()<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'rdd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `reduceByKey`\n\n::: {#94f75add .cell execution_count=62}\n``` {.python .cell-code}\nrdd = sc.parallelize([(\"a\", 1), (\"b\", 1), (\"a\", 1)])\nrdd.reduceByKey(lambda a, b: a + b).collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[134], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([(<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">1</span>), (<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">1</span>), (<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">\"</span>, <span style=\"color:rgb(98,98,98)\">1</span>)])\n<span class=\"ansi-green-fg ansi-bold\">      2</span> rdd<span style=\"color:rgb(98,98,98)\">.</span>reduceByKey(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> a, b: a <span style=\"color:rgb(98,98,98)\">+</span> b)<span style=\"color:rgb(98,98,98)\">.</span>collect()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `combineByKey`\n\n::: {#16eeeba6 .cell execution_count=63}\n``` {.python .cell-code}\nrdd = sc.parallelize([('a', 1), ('b', 2), ('a', 13)])\n\ndef add(a, b): \n    return a + str(b)\n\nrdd.combineByKey(str, add, add).collect()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[135], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> rdd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([(<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">'</span>, <span style=\"color:rgb(98,98,98)\">1</span>), (<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">b</span><span style=\"color:rgb(175,0,0)\">'</span>, <span style=\"color:rgb(98,98,98)\">2</span>), (<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">a</span><span style=\"color:rgb(175,0,0)\">'</span>, <span style=\"color:rgb(98,98,98)\">13</span>)])\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">def</span> <span style=\"color:rgb(0,0,255)\">add</span>(a, b): \n<span class=\"ansi-green-fg ansi-bold\">      4</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">return</span> a <span style=\"color:rgb(98,98,98)\">+</span> <span style=\"color:rgb(0,135,0)\">str</span>(b)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### `join`, `rightOuterJoin`, `leftOuterJoin`\n\n::: {#1aaef769 .cell execution_count=64}\n``` {.python .cell-code}\nemployees = sc.parallelize([\n    (31, \"Rafferty\"),\n    (33, \"Jones\"),\n    (33, \"Heisenberg\"),\n    (34, \"Robinson\"),\n    (34, \"Smith\"),\n    (None, \"Williams\")\n])\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[136], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> employees <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([\n<span class=\"ansi-green-fg ansi-bold\">      2</span>     (<span style=\"color:rgb(98,98,98)\">31</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Rafferty</span><span style=\"color:rgb(175,0,0)\">\"</span>),\n<span class=\"ansi-green-fg ansi-bold\">      3</span>     (<span style=\"color:rgb(98,98,98)\">33</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Jones</span><span style=\"color:rgb(175,0,0)\">\"</span>),\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     (<span style=\"color:rgb(98,98,98)\">33</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Heisenberg</span><span style=\"color:rgb(175,0,0)\">\"</span>),\n<span class=\"ansi-green-fg ansi-bold\">      5</span>     (<span style=\"color:rgb(98,98,98)\">34</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Robinson</span><span style=\"color:rgb(175,0,0)\">\"</span>),\n<span class=\"ansi-green-fg ansi-bold\">      6</span>     (<span style=\"color:rgb(98,98,98)\">34</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Smith</span><span style=\"color:rgb(175,0,0)\">\"</span>),\n<span class=\"ansi-green-fg ansi-bold\">      7</span>     (<span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Williams</span><span style=\"color:rgb(175,0,0)\">\"</span>)\n<span class=\"ansi-green-fg ansi-bold\">      8</span> ])\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#68846ce6 .cell execution_count=65}\n``` {.python .cell-code}\ndepartments = sc.parallelize([\n    (31, \"Sales\"),\n    (33, \"Engineering\"),\n    (34, \"Clerical\"),\n    (35, \"Marketing\")\n])\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[137], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> departments <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">sc</span><span style=\"color:rgb(98,98,98)\">.</span>parallelize([\n<span class=\"ansi-green-fg ansi-bold\">      2</span>     (<span style=\"color:rgb(98,98,98)\">31</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Sales</span><span style=\"color:rgb(175,0,0)\">\"</span>),\n<span class=\"ansi-green-fg ansi-bold\">      3</span>     (<span style=\"color:rgb(98,98,98)\">33</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Engineering</span><span style=\"color:rgb(175,0,0)\">\"</span>),\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     (<span style=\"color:rgb(98,98,98)\">34</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Clerical</span><span style=\"color:rgb(175,0,0)\">\"</span>),\n<span class=\"ansi-green-fg ansi-bold\">      5</span>     (<span style=\"color:rgb(98,98,98)\">35</span>, <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Marketing</span><span style=\"color:rgb(175,0,0)\">\"</span>)\n<span class=\"ansi-green-fg ansi-bold\">      6</span> ])\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'sc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#0cdcc76f .cell execution_count=66}\n``` {.python .cell-code}\n( \n    employees\n        .join(departments)\n        .sortByKey()\n        .collect()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[138], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> ( \n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">employees</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span>         <span style=\"color:rgb(98,98,98)\">.</span>join(departments)\n<span class=\"ansi-green-fg ansi-bold\">      4</span>         <span style=\"color:rgb(98,98,98)\">.</span>sortByKey()\n<span class=\"ansi-green-fg ansi-bold\">      5</span>         <span style=\"color:rgb(98,98,98)\">.</span>collect()\n<span class=\"ansi-green-fg ansi-bold\">      6</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'employees' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#f3a189df .cell execution_count=67}\n``` {.python .cell-code}\n( \n    employees\n        .rightOuterJoin(departments)\n        .sortByKey()\n        .collect()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[139], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> ( \n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">employees</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span>         <span style=\"color:rgb(98,98,98)\">.</span>rightOuterJoin(departments)\n<span class=\"ansi-green-fg ansi-bold\">      4</span>         <span style=\"color:rgb(98,98,98)\">.</span>sortByKey()\n<span class=\"ansi-green-fg ansi-bold\">      5</span>         <span style=\"color:rgb(98,98,98)\">.</span>collect()\n<span class=\"ansi-green-fg ansi-bold\">      6</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'employees' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#a9247f55 .cell execution_count=68}\n``` {.python .cell-code}\n(\n    employees\n        .leftOuterJoin(departments)\n        .collect()\n)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[140], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> (\n<span class=\"ansi-green-fg\">----&gt; 2</span>     <span class=\"ansi-yellow-bg\">employees</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span>         <span style=\"color:rgb(98,98,98)\">.</span>leftOuterJoin(departments)\n<span class=\"ansi-green-fg ansi-bold\">      4</span>         <span style=\"color:rgb(98,98,98)\">.</span>collect()\n<span class=\"ansi-green-fg ansi-bold\">      5</span> )\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'employees' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n## Actions\n\n::: {#3dbc3684 .cell execution_count=69}\n``` {.python .cell-code}\nemployees.countByKey()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[141], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">employees</span><span style=\"color:rgb(98,98,98)\">.</span>countByKey()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'employees' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#3eab0c8b .cell execution_count=70}\n``` {.python .cell-code}\nemployees.lookup(33)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[142], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">employees</span><span style=\"color:rgb(98,98,98)\">.</span>lookup(<span style=\"color:rgb(98,98,98)\">33</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'employees' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#23bb09c1 .cell execution_count=71}\n``` {.python .cell-code}\nemployees.lookup(None)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[143], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">employees</span><span style=\"color:rgb(98,98,98)\">.</span>lookup(<span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'employees' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#8a4fa115 .cell execution_count=72}\n``` {.python .cell-code}\nemployees.collectAsMap()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[144], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">employees</span><span style=\"color:rgb(98,98,98)\">.</span>collectAsMap()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'employees' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n## References\n\n[Spark Core reference](https://spark.apache.org/docs/latest/rdd-programming-guide.html)\n\n",
    "supporting": [
      "notebook05_sparkrdd_files"
    ],
    "filters": [],
    "includes": {}
  }
}